---
layout: post
title: "NIO：基本概念"
date: 2017-09-19 22:22:00 +0800
categories: nio
tag: [nio,java]
---
* content
{:toc}

《Java NIO》学习笔记，I/O基本概念。

---

<!-- more -->
<!-- TOC -->

- [1. IO概述](#1-io概述)


<!-- /TOC -->

# 1. IO概述

####    缓存区

所谓“输入/输出”讲的无非就是把数据移进或移出缓冲区。

进程执行 I/O 操作,归结起来,也就是向操作系统发出请求,让它要么把缓冲区里的数据排干 (写),要么用数据把缓冲区填满(读)。

进程使用这一机制处理所有数据进出操作。

---

####    发散/汇聚

---

####    虚拟内存

1. 一个以上的虚拟地址可指向同一个物理内存地址。
2. 虚拟内存空间可大于实际可用的硬件内存。

---

####    内存页面调度

* 为了支持虚拟内存的第二个特性,就必须进行虚拟内存分页。
* 现代 CPU 包含一个称为内存管理单元(MMU)的子系统,该设备包含虚拟地址向物理内存地址转换时所需映射信息。
* 如果当前不存在与该虚拟页形成有效映射的物理内存页, MMU 会向 CPU 􏸯交一个页错误。
* 页错误随即产生一个陷阱, 把控制权移交给内核, 内核会安排页面调入操作, 把缺失的页内容读回物理内存。这往往导致别的页被移出物理内存。
* 如果所要求的地址不是有效的虚拟内存地址, 则该页不能通过验证, 段错误随即产生, 通常导致的结果就是进程被强令关闭。

---

####    文件IO

* 磁盘属硬件设备,对何谓文件一无所知, 它只是􏸯供了一系列数据存取窗口
* 文件系统是更高层次的抽象, 是安排、解释磁盘(或其他随机存取块设备)数据的一种独特方式
* 文件系统把一连串大小一致的数据块组织到一起。有些块存储元信息,如空闲块、目录、索引等的映射,有些包含文件数据。

采用分页技术的操作系统执行 I/O 的全过程可总结为以下几步:
* 确定请求的数据分布在文件系统的哪些页(磁盘扇区组)。磁盘上的文件内容和元数据可能跨越多个文件系统页,而且这些页可能也不连续。
* 在内核空间分配足够数量的内存页,以容纳得到确定的文件系统页。
* 在内存页与磁盘上的文件系统页之间建立映射。
* 为每一个内存页产生页错误。
* 虚拟内存系统俘获页错误,安排页面调入,从磁盘上读取页内容,使页有效。
* 一旦页面调入操作完成,文件系统即对原始数据进行解析,取得所需文件内容或属性信息。

---

####    内存映射文件

内存映射 I/O 使用文件系统建立从用户空间直到可用文件系统页的虚拟内存映射。好处：
* 用户进程把文件数据当作内存,所以无需发布 read( )或 write( )系统调用。
* 当用户进程碰触到映射内存空间,页错误会自动产生,从而将文件数据从磁盘读进内存。如果用户修改了映射内存空间,相关页会自动标记为脏,随后刷新到磁盘,文件得到更新。
* 操作系统的虚拟内存子系统会对页进行智能高速缓存,自动根据系统负载进行内存管理。
* 数据总是按页对齐的,无需执行缓冲区拷贝。
* 大型文件使用映射,无需耗费大量内存,即可进行数据拷贝。

虚拟内存和磁盘 I/O 是紧密关联的,从很多方面看来,它们只是同一件事物的两面。

---

####    文件锁定

* 文件锁定机制允许一个进程阻止其他进程存取某文件,或限制其存取方式。
* 文件锁定有两种方式:共享的和独占的

---

### 流I/O

* 并非所有 I/O 都像前几节讲的是面向块的,也有流 I/O,其原理模仿了通道
* 多数操作系统允许把流置于非块模式,这样,进程可以查看流上是否有输入,即便当时没有也不影响它干别的。这样一种能力使得进程可以在有输入的时候进行处理,输入流闲置的时候执行其他功能。
* 比非块模式再进一步,就是就绪性选择。就绪性选择与非块模式类似,但是把查看流是否就绪的任务交给了操作系统。


